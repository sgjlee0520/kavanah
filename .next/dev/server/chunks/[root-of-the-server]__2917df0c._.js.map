{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/johnlee/Desktop/kavanah/src/app/api/guidance/route.ts"],"sourcesContent":["import { deepseek } from \"@ai-sdk/deepseek\";\nimport { streamText } from \"ai\";\n\nexport async function POST(req: Request) {\n    try {\n        const { prompt } = await req.json();\n\n        const systemPrompt = `You are a wise, compassionate, and deeply spiritual Rabbi. Your goal is to provide spiritual comfort and guidance based on Jewish wisdom.\n\nTASK:\n1. Analyze the user's struggle, emotion, or question deeply.\n2. If emotional (anxiety, grief, fear, loneliness, joy), select a relevant verse from Tehillim (Psalms).\n3. If ethical, behavioral, or decision-based, select a teaching from Pirkei Avot (Ethics of the Fathers).\n\nRESPOND ONLY WITH VALID JSON.\nDO NOT use markdown code fences. DO NOT include any text before or after the JSON.\n\nSCHEMA:\n{\n  \"hebrew\": \"Hebrew text with nikkud (vowels)\",\n  \"englishTranslation\": \"English translation (use 'Hashem' for God)\",\n  \"source\": \"Citation (e.g., Tehillim 23:4)\",\n  \"insight\": \"Exactly 3 sentences connecting the source to the user's struggle.\"\n}\n\nRULES:\n- Never write the Tetragrammaton; use ה' or א-לוהים.\n- The response must be a single JSON object starting with { and ending with }.`;\n\n        // ROUTING VERIFICATION PROBE\n        console.log(\"PROBE: Hitting route.ts\");\n        return new Response(JSON.stringify({ status: \"Teapot\" }), { status: 418 });\n\n        /*\n        // DEBUG: Hardcoded response\n        return new Response(JSON.stringify({\n            hebrew: \"שָׁלוֹם\",\n            englishTranslation: \"Peace\",\n            source: \"Gen 1:1\",\n            insight: \"Sentence one. Sentence two. Sentence three.\"\n        }), {\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"x-debug\": \"hardcoded\"\n            }\n        });\n\n        if (!process.env.DEEPSEEK_API_KEY) {\n            console.error(\"Missing DEEPSEEK_API_KEY environment variable\");\n            return new Response(\n                JSON.stringify({ error: \"Configuration Error: API Key missing.\" }),\n                { status: 500, headers: { \"Content-Type\": \"application/json\" } }\n            );\n        }\n\n        console.log(\"RECEIVED PROMPT:\", prompt);\n        console.log(\"SYSTEM PROMPT LENGTH:\", systemPrompt.length);\n        console.log(\"API KEY MASKED:\", process.env.DEEPSEEK_API_KEY?.slice(0, 5) + \"...\");\n\n        /*\n        const result = await streamText({\n            model: deepseek(\"deepseek-chat\"),\n            messages: [\n                { role: \"system\", content: systemPrompt },\n                {\n                    role: \"user\",\n                    content: `USER STRUGGLE: ${prompt}\\n\\nIMPORTANT: You are a Rabbi. You MUST respond with ONLY the JSON object defined in your instructions. Do not repeat the user's input. Start your response with '{'.`\n                },\n                { role: \"assistant\", content: \"{\" }\n            ],\n            temperature: 0,\n        });\n\n        return result.toTextStreamResponse();\n        */\n    } catch (error: any) {\n        console.error(\"Error generating guidance:\", error);\n        return new Response(\n            JSON.stringify({\n                error: \"Failed to seek wisdom at this time.\",\n                details: error.message || \"Unknown error\"\n            }),\n            { status: 500, headers: { \"Content-Type\": \"application/json\" } }\n        );\n    }\n}\n"],"names":[],"mappings":";;;;AAGO,eAAe,KAAK,GAAY;IACnC,IAAI;QACA,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,IAAI;QAEjC,MAAM,eAAe,CAAC;;;;;;;;;;;;;;;;;;;;8EAoBgD,CAAC;QAEvE,6BAA6B;QAC7B,QAAQ,GAAG,CAAC;QACZ,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,QAAQ;QAAS,IAAI;YAAE,QAAQ;QAAI;IAExE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAyCA,GACJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,IAAI,SACP,KAAK,SAAS,CAAC;YACX,OAAO;YACP,SAAS,MAAM,OAAO,IAAI;QAC9B,IACA;YAAE,QAAQ;YAAK,SAAS;gBAAE,gBAAgB;YAAmB;QAAE;IAEvE;AACJ"}}]
}