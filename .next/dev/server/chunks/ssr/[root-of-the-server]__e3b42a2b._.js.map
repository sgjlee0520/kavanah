{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/johnlee/Desktop/kavanah/src/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useMemo, useEffect } from \"react\";\nimport { useCompletion } from \"@ai-sdk/react\";\n\nexport default function Home() {\n  const [error, setError] = useState<string | null>(null);\n  const [hasSubmitted, setHasSubmitted] = useState(false);\n\n  const {\n    completion,\n    input,\n    handleInputChange,\n    handleSubmit: originalHandleSubmit,\n    isLoading,\n  } = useCompletion({\n    api: \"/api/guidance\",\n    onError: (err) => {\n      console.error(\"API ERROR:\", err);\n      setError(`API Error: ${err.message}`);\n      setHasSubmitted(false); // Allow retry on API error\n    },\n    onFinish: (message) => {\n      console.log(\"Stream finished. Completion:\", message);\n    },\n  });\n\n  // Log completion changes for debugging\n  useEffect(() => {\n    if (completion) {\n      console.log(\"Completion updated:\", completion);\n    }\n  }, [completion]);\n\n  // Wrap handleSubmit to track submission state\n  const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n    setHasSubmitted(true);\n    setError(null);\n    originalHandleSubmit(e);\n  };\n\n  // Parse valid JSON from the completion string if it exists\n  // Use useMemo to avoid re-parsing on every render\n  const responseData = useMemo(() => {\n    if (!completion) return null;\n\n    try {\n      // First, try direct parse\n      return JSON.parse(completion);\n    } catch (e) {\n      console.error(\"Direct parse failed, attempting reconstruction:\", e);\n\n      // If the completion is missing the opening brace (due to pre-fill handling)\n      let textToParse = completion.trim();\n      if (textToParse && !textToParse.startsWith(\"{\")) {\n        textToParse = \"{\" + textToParse;\n      }\n      if (textToParse && !textToParse.endsWith(\"}\")) {\n        textToParse = textToParse + \"}\";\n      }\n\n      // Try to extract JSON object\n      const jsonObjectMatch = textToParse.match(/\\{[\\s\\S]*\\}/);\n      if (jsonObjectMatch) {\n        try {\n          return JSON.parse(jsonObjectMatch[0]);\n        } catch (e2) {\n          console.error(\"JSON object extraction failed:\", e2);\n        }\n      }\n      return null;\n    }\n  }, [completion]);\n\n  // Track parse failure AFTER streaming is complete\n  const showParseError = !isLoading && hasSubmitted && completion && !responseData;\n\n  // Debug: Log when parse error occurs\n  useEffect(() => {\n    if (showParseError) {\n      console.error(\"Parse error - completion received but couldn't parse:\", completion);\n    }\n  }, [showParseError, completion]);\n\n  // Reset function for clean state\n  const handleReset = () => {\n    setHasSubmitted(false);\n    setError(null);\n    window.location.reload();\n  };\n\n  return (\n    <main className=\"min-h-screen flex flex-col items-center justify-center p-4 bg-royal-blue-900 text-white relative overflow-hidden\">\n      {/* Background accents */}\n      <div className=\"absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0\">\n        <div className=\"absolute top-[-10%] right-[-5%] w-96 h-96 bg-royal-blue-600 rounded-full blur-[100px] opacity-20\"></div>\n        <div className=\"absolute bottom-[-10%] left-[-5%] w-72 h-72 bg-silver-400 rounded-full blur-[80px] opacity-10\"></div>\n      </div>\n\n      <div className=\"max-w-2xl w-full z-10 flex flex-col items-center space-y-12\">\n        {/* Header */}\n        <header className=\"text-center space-y-4\">\n          <h1 className=\"text-4xl md:text-5xl font-serif tracking-wide text-silver-100 drop-shadow-lg\">\n            What is on your heart?\n          </h1>\n          <p className=\"text-royal-blue-200 text-lg font-light tracking-wider\">\n            Share your struggle, receive ancient wisdom.\n          </p>\n        </header>\n\n        {/* Input Form - Show unless there's a successful response */}\n        {!responseData && (\n          <form\n            onSubmit={handleSubmit}\n            className=\"w-full max-w-lg transition-all transform duration-700 ease-in-out\"\n          >\n            <div className=\"relative group\">\n              <textarea\n                value={input}\n                onChange={handleInputChange}\n                placeholder=\"Ex: I feel anxious about my future...\"\n                disabled={isLoading}\n                className=\"w-full min-h-20 max-h-48 bg-white/5 border border-white/10 rounded-xl px-6 py-4 text-lg text-white placeholder-white/30 focus:outline-none focus:ring-2 focus:ring-silver-400/50 focus:bg-white/10 transition-all shadow-2xl backdrop-blur-sm resize-none overflow-y-auto disabled:opacity-50 disabled:cursor-not-allowed\"\n              />\n              <button\n                type=\"submit\"\n                disabled={!input.trim() || isLoading}\n                className=\"absolute right-2 top-2 px-6 bg-silver-200 hover:bg-white text-royal-blue-900 font-medium rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg\"\n              >\n                Seek\n              </button>\n            </div>\n            {error && <p className=\"text-red-400 mt-2 text-center text-sm\">{error}</p>}\n          </form>\n        )}\n\n        {/* Parse Error State - Show when streaming complete but JSON invalid */}\n        {showParseError && (\n          <div className=\"w-full max-w-lg bg-red-500/10 border border-red-400/30 rounded-xl p-6 text-center space-y-4\">\n            <p className=\"text-red-300 text-sm\">\n              We received wisdom, but couldn't interpret it. Please check the browser console for details.\n            </p>\n            <p className=\"text-red-200 text-xs font-mono break-words max-h-32 overflow-y-auto bg-red-950/30 p-2 rounded\">\n              {completion?.substring(0, 200)}...\n            </p>\n            <button\n              onClick={handleReset}\n              className=\"text-white/60 hover:text-white transition-colors text-sm uppercase tracking-widest\"\n            >\n              Try Again\n            </button>\n          </div>\n        )}\n\n        {/* Loading State */}\n        {isLoading && (\n          <div className=\"flex flex-col items-center space-y-4 animate-pulse-gentle\">\n            <div className=\"w-16 h-16 border-t-2 border-r-2 border-silver-300 rounded-full animate-spin duration-[3000ms]\"></div>\n            <p className=\"text-silver-200 font-serif text-lg tracking-widest uppercase text-xs\">\n              Seeking Wisdom...\n            </p>\n          </div>\n        )}\n\n        {/* Response Card */}\n        {responseData && (\n          <div className=\"w-full bg-white/5 border border-white/10 rounded-2xl p-8 md:p-12 shadow-2xl backdrop-blur-md space-y-8 animate-in fade-in duration-1000 slide-in-from-bottom-10\">\n            {/* Hebrew Text */}\n            <div className=\"text-center space-y-4\">\n              <p dir=\"rtl\" className=\"text-3xl md:text-4xl font-frank-ruhl text-silver-100 leading-relaxed drop-shadow-md\">\n                {responseData.hebrew}\n              </p>\n            </div>\n\n            {/* Divider */}\n            <div className=\"flex justify-center\">\n              <div className=\"w-12 h-px bg-white/20\"></div>\n            </div>\n\n            {/* English Translation */}\n            <div className=\"text-center space-y-2\">\n              <p className=\"text-xl text-white/90 font-serif italic\">\n                \"{responseData.englishTranslation}\"\n              </p>\n              <p className=\"text-sm text-silver-400 tracking-widest uppercase mt-4\">\n                {responseData.source}\n              </p>\n            </div>\n\n            {/* Rabbi's Insight */}\n            <div className=\"bg-royal-blue-950/50 rounded-xl p-6 border border-white/5\">\n              <h3 className=\"text-silver-300 text-xs font-bold uppercase tracking-widest mb-2\">\n                Rabbi's Insight\n              </h3>\n              <p className=\"text-royal-blue-100 leading-relaxed\">\n                {responseData.insight}\n              </p>\n            </div>\n\n            {/* Reset Button */}\n            <div className=\"text-center pt-4\">\n              <button\n                onClick={handleReset}\n                className=\"text-white/40 hover:text-white transition-colors text-sm uppercase tracking-widest\"\n              >\n                Ask Another Question\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}